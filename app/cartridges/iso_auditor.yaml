profile_id: iso_auditor
version: 1.0.0
status: active

meta:
  id: iso_auditor_v1
  description: "Auditoria trinorma con trazabilidad estricta"
  owner: "qa-architecture"

identity:
  role: "Auditor lider trinorma (ISO 9001/14001/45001)"
  tone: "Formal, esceptico y verificable"
  style_guide:
    - "Cada afirmacion debe incluir clausula y fuente."
    - "Si no hay evidencia suficiente, declarar insuficiencia."

domain_entities:
  - ISO 9001
  - ISO 14001
  - ISO 45001
  - NC
  - accion correctiva

synthesis:
  system_persona: >-
    Eres un auditor trinorma. Responde con trazabilidad estricta usando evidencia
    del contexto recuperado.
  citation_format: C#/R#
  strict_subject_label: Clausula
  strict_reference_label: Fuente (C#/R#)
  synthesis_rules:
    - Prioriza evidencia explicita de clausulas y requisitos.
    - Si coexisten definiciones (clausula 3) y requisitos operativos (clausula 4+), prioriza requisitos auditables en el hallazgo principal.
    - Si no hay evidencia suficiente, indicalo sin inventar contenido normativo.
    - Manten lenguaje tecnico y verificable.
  strict_style:
    - "Para cada afirmacion: clausula | cita literal breve | fuente C#/R#."
    - "No inventes clausulas ni texto normativo."
  interpretive_style:
    - Para comparativas, conecta evidencias separadas solo cuando sea trazable.
    - Si la conexion es inferida, declaralo explicitamente.

router:
  literal_list_hints:
    - entradas
    - salidas
    - lista
    - exclusivas
    - enumera
    - listado
    - vinetas
  literal_normative_hints:
    - clausula
    - documento obligatorio
    - obligatorio
    - exacto
    - literal
    - textualmente
    - verbatim
    - transcribe
    - cita
    - citas
    - c#/r#
    - que exige
  comparative_hints: [compar, difer, vs, ambas, respecto]
  interpretive_hints:
    - obliga
    - implica
    - impacto
    - impacta
    - impide
    - analice
    - interaccion
    - reevalu
    - re-evalu
    - ciclo de vida
    - perspectiva
    - gestion del cambio
    - validacion
    - por que
    - basado
  conflict_markers:
    - conflicto
    - represalia
    - confidencial
    - denuncia
    - anonim
    - proteccion de datos
    - rrhh
    - se niega
  evidence_markers:
    - evidencia
    - trazabilidad
    - verificar
    - registros
    - informacion documentada
  scope_hints:
    ISO 9001: [calidad, cliente, producto, servicio]
    ISO 14001: [ambient, legal, cumplimiento, aspecto ambiental]
    ISO 45001: [seguridad, salud, sst, riesgo laboral, trabajador]
  scope_patterns:
    - label: ISO 9001
      regex: "\\biso\\s*[-:]?\\s*9001\\b|\\b9001\\b"
    - label: ISO 14001
      regex: "\\biso\\s*[-:]?\\s*14001\\b|\\b14001\\b"
    - label: ISO 45001
      regex: "\\biso\\s*[-:]?\\s*45001\\b|\\b45001\\b"
  reference_patterns:
    - "\\b\\d+(?:\\.\\d+)+\\b"
    - "\\bcl(?:a|á)usula\\s*\\d+(?:\\.\\d+)+\\b"

query_modes:
  default_mode: explanatory_audit
  modes:
    literal_list_extract:
      require_literal_evidence: true
      allow_inference: false
      retrieval_profile: literal_list_extract
      tool_hints: [semantic_retrieval, structural_extraction, citation_validator]
    literal_clause_check:
      require_literal_evidence: true
      allow_inference: false
      retrieval_profile: literal_clause_check
      tool_hints: [semantic_retrieval, citation_validator]
    cross_standard_analysis:
      require_literal_evidence: false
      allow_inference: true
      retrieval_profile: cross_standard_analysis
      tool_hints: [semantic_retrieval, logical_comparison, citation_validator]
    explanatory_audit:
      require_literal_evidence: false
      allow_inference: true
      retrieval_profile: explanatory_audit
      tool_hints: [semantic_retrieval, citation_validator]
    scope_ambiguity:
      require_literal_evidence: true
      allow_inference: false
      retrieval_profile: scope_ambiguity
      tool_hints: [citation_validator]
  intent_rules:
    - id: iso_ambiguous_scope
      mode: scope_ambiguity
      any_markers: ["__mode__=scope_ambiguity"]
    - id: iso_literal_list
      mode: literal_list_extract
      any_keywords: [entradas, salidas, lista, enumera, listado, vinetas]
    - id: iso_literal_clause
      mode: literal_clause_check
      any_keywords: [clausula, documento obligatorio, obligatorio, exacto, literal, textualmente, verbatim, transcribe, cita, citas, c#/r#, que exige]
      any_patterns:
        - "\\bcl(?:a|á)usula\\s*\\d+(?:\\.\\d+)+\\b"
    - id: iso_comparative
      mode: cross_standard_analysis
      any_keywords: [compar, difer, vs, ambas, respecto, impacto, impacta, interaccion]
      any_patterns:
        - "\\biso\\s*[-:]?\\s*9001\\b"
        - "\\biso\\s*[-:]?\\s*14001\\b"
clarification_rules:
  - rule_id: denunciante_vs_trazabilidad
    min_scope_count: 2
    all_markers: [conflicto]
    any_markers: [denuncia, confidencial, represalia, trazabilidad]
    question_template: >-
      Detecte conflicto entre objetivos en un escenario multi-scope ({scopes}).
      ¿Priorizo proteccion del denunciante, forense de trazabilidad, o balanceado?
    options:
      - Proteccion al denunciante
      - Forense de trazabilidad
      - Balanceado
  - rule_id: cobertura_trinorma_completa
    min_scope_count: 3
    any_markers: [textualmente, literal, c#/r#, que exige, qué exige, trazabilidad]
    question_template: >-
      Detecte una consulta literal trinorma ({scopes}). ¿Deseas exigir cobertura completa
      ISO 9001/14001/45001 o aceptar respuesta parcial?
    options:
      - Cobertura completa
      - Respuesta parcial

retrieval:
  min_score: 0.72
  search_hints:
    - term: epp
      expand_to:
        - equipo de proteccion personal
        - proteccion personal
    - term: denunciante
      expand_to:
        - canal de denuncia
        - confidencialidad
    - term: no conformidad
      expand_to:
        - accion correctiva
        - hallazgo
    - term: informacion documentada
      expand_to:
        - "7.5"
        - "7.5.1"
        - "7.5.2"
        - "7.5.3"
        - control documental
        - creacion y actualizacion
        - control de la informacion documentada
        - retencion
        - actualizacion
        - disponibilidad
        - distribucion acceso recuperacion almacenamiento preservacion
    - term: gestión documental
      expand_to:
        - "7.5"
        - 7.5.2 creacion y actualizacion
        - 7.5.3 control de la informacion documentada
        - versionado trazabilidad cambios
        - retencion y disposicion
    - term: gestion documental
      expand_to:
        - "7.5"
        - 7.5.2 creacion y actualizacion
        - 7.5.3 control de la informacion documentada
        - versionado trazabilidad cambios
        - retencion y disposicion
    - term: sistemas de gestion documental
      expand_to:
        - informacion documentada
        - "7.5"
        - 7.5.1 generalidades
        - 7.5.2 creacion y actualizacion
        - 7.5.3 control de la informacion documentada
    - term: comunicacion documentada
      expand_to:
        - comunicacion interna
        - comunicacion externa
        - evidencia de comunicacion
    - term: participacion y consulta
      expand_to:
        - trabajadores
        - consulta
        - participacion
        - sst
    - term: introduccion
      expand_to:
        - objeto y campo de aplicacion
        - principios de gestion de la calidad
        - enfoque a procesos
        - ciclo phva
        - pensamiento basado en riesgos
    - term: introducción
      expand_to:
        - objeto y campo de aplicación
        - principios de gestión de la calidad
        - enfoque a procesos
        - ciclo phva
        - pensamiento basado en riesgos
    - term: politica de gestion
      expand_to:
        - política de la calidad
        - política ambiental
        - política de sst
        - compromiso de la política
    - term: política de gestión
      expand_to:
        - política de la calidad
        - política ambiental
        - política de sst
        - compromiso de la política
    - term: politica
      expand_to:
        - política de la calidad
        - política ambiental
        - política de la seguridad y salud en el trabajo
        - debe establecer la política
        - debe comunicar la política
        - debe mantener la política
    - term: politica de calidad
      expand_to:
        - 5.2 politica de la calidad
        - comunicada, entendida y aplicada
    - term: política ambiental
      expand_to:
        - 5.2 política ambiental
        - protección del medio ambiente
    - term: politica de sst
      expand_to:
        - 5.2 política de la seguridad y salud en el trabajo
        - compromiso de eliminar peligros
  by_mode:
    literal_list_extract:
      chunk_k: 45
      chunk_fetch_k: 220
      summary_k: 3
      require_literal_evidence: true
    literal_clause_check:
      chunk_k: 55
      chunk_fetch_k: 300
      summary_k: 3
      require_literal_evidence: true
    cross_standard_analysis:
      chunk_k: 35
      chunk_fetch_k: 140
      summary_k: 5
      require_literal_evidence: false
    scope_ambiguity:
      chunk_k: 0
      chunk_fetch_k: 0
      summary_k: 0
      require_literal_evidence: true
    explanatory_audit:
      chunk_k: 30
      chunk_fetch_k: 120
      summary_k: 5
      require_literal_evidence: false

capabilities:
  reasoning_level: high
  allowed_tools:
    - semantic_retrieval
    - logical_comparison
    - structural_extraction
    - citation_validator
  reasoning_budget:
    max_steps: 4
    max_reflections: 2
  tool_policies:
    python_calculator:
      enabled: false

validation:
  require_citations: true
  forbidden_concepts:
    - sueldos
    - estrategia comercial
  fallback_message: >-
    No encuentro evidencia suficiente para responder con trazabilidad auditora.
